# 村镇级3D地图系统 - 简化版

## 🚀 项目概述

这是一个基于Vue 3 + Three.js的村镇级3D地图可视化系统，专门用于展示村镇级别的地理信息。该版本经过简化，专注于核心的地图加载和基本视觉效果。

## ✨ 主要功能

### 核心功能
- 🗺️ **3D地图渲染** - 基于GeoJSON数据的3D村镇地图展示
- 📂 **多格式数据加载** - 支持JSON、GeoJSON格式文件加载
- 📷 **智能相机控制** - 自动适配地图大小，最佳视角显示
- 🎨 **视觉效果** - 科技感背景、增强光照效果、旋转边框
- 🖱️ **鼠标悬停交互** - 区域凸起（2.5倍高度）、高亮显示、信息面板
- 🔄 **动态切换** - 实时切换不同数据源
- 🏷️ **村镇名称标签** - 动态显示村镇名称标签
- 🎯 **单独显示功能** - 点击村镇单独显示该区域，再次点击返回全部显示
- ⭐ **参考原项目效果** - 与省级地图相同的交互体验

### 视觉特效
- 🌫️ **雾化效果** - 深度层次感
- 💫 **底部网格** - 科技感地面效果
- 🔄 **旋转边框** - 动态装饰元素
- 🎭 **入场动画** - 平滑的场景载入

## 🛠️ 技术栈

- **前端框架**: Vue 3 (Composition API)
- **3D引擎**: Three.js
- **地理投影**: d3-geo (Mercator投影)
- **动画库**: GSAP
- **构建工具**: Vite

## 📁 项目结构

```
src/views/town-map/
├── town-map.vue          # Vue主组件（简化版）
├── town-world.js         # 3D世界管理器（核心功能）
├── town-map-renderer.js  # 地图渲染器
└── README_TOWN_MAP.md    # 项目文档
```

## 🗃️ 数据格式

系统支持标准的GeoJSON格式数据：

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "文昌镇",
        "adcode": "640502001",
        "centroid": [105.189, 37.503],
        "population": 25000,
        "area": 125.5,
        "gdp": 8.5
      },
      "geometry": {
        "type": "MultiPolygon",
        "coordinates": [...]
      }
    }
  ]
}
```

## 🎮 使用说明

### 访问地图
1. 启动项目：`npm run dev`
2. 访问村镇地图页面：
```
http://localhost:5174/#/town-map
```
或者
```
http://localhost:5174/#/town-map-animate
```
3. 或从主地图点击"村镇级地图"按钮进入

### 交互操作
- **数据源选择** - 通过下拉菜单选择不同的数据文件
- **鼠标拖拽** - 旋转地图视角
- **鼠标滚轮** - 缩放地图
- **鼠标悬停** - 区域凸起高亮 + 信息面板显示
- **鼠标点击** - 单独显示选中的村镇地图，再次点击返回全部显示
- **重置视角** - 点击导航栏"重置视角"按钮

### 悬停交互效果
- **区域凸起** - Z轴缩放至2.5倍，增强3D立体感
- **材质高亮** - 发光效果，深蓝色高亮显示
- **脉冲呼吸** - 持续的呼吸动画效果
- **信息面板** - 右上角显示区域详细信息
  - 区域名称
  - 人口数量
  - 区域面积
- **平滑过渡** - 使用GSAP动画，0.3秒缓动效果
- **层级提升** - 高亮区域渲染在最前面
- **Y轴抖动** - 轻微的Y轴位移增加动感

### 支持的数据格式
- **标准GeoJSON** - 完整的FeatureCollection格式
- **简化JSON** - 包含几何体和属性的JSON文件
- **数组格式** - Feature对象的数组
- **内置数据** - 预设的测试数据

### 数据文件路径
系统会按优先级尝试加载以下数据源：
1. `/assets/testTownData/example.json` - 示例数据
2. `/assets/testTownData/test.geojson` - 测试GeoJSON
3. `/assets/testTownData/shapotou.json` - 沙坡头数据
4. `/assets/json/中华人民共和国.json` - 中国地图数据
5. 内置测试数据（兜底方案）

## 🔧 配置说明

### 相机参数
```javascript
camera: {
  fov: 75,           // 视角
  near: 0.1,         // 近裁剪面
  far: 1000,         // 远裁剪面
  autoFit: true      // 自动适配地图大小
}
```

### 材质配置
```javascript
topMaterial: {
  color: 0x061e47,        // 地图顶面颜色
  opacity: 0.9,           // 透明度
  metalness: 0.2,         // 金属度
  roughness: 0.8          // 粗糙度
}
```

## 🎨 样式定制

### 主要颜色
- **主色调**: `#2bc4dc` (青蓝色)
- **背景色**: `#011024` (深蓝色)
- **地图色**: `#061e47` (深蓝灰)
- **强调色**: `#0e81fb` (亮蓝色)

### CSS变量
```scss
--primary-color: #2bc4dc;
--background-color: #011024;
--map-color: #061e47;
--accent-color: #0e81fb;
```

## ⚡ 性能优化

- **几何体复用** - 减少内存占用
- **材质共享** - 提升渲染效率
- **LOD优化** - 基于距离调整细节
- **事件节流** - 优化交互响应

## 🐛 故障排除

### 常见问题

1. **地图不显示**
   - 检查数据格式是否正确
   - 确认centroid字段存在

2. **相机位置异常**
   - 点击"重置视角"按钮
   - 检查地理投影是否正确

3. **性能问题**
   - 减少地图多边形复杂度
   - 降低渲染质量设置

## 📝 开发日志

### v2.4.0 (单独显示功能版)
- ✅ 重新设计村镇名称标签（CSS2D渲染）
- ✅ 标签显示在区域正上方
- ✅ 实现点击单独显示村镇功能
- ✅ 再次点击返回全部显示
- ✅ 聚焦动画和相机自适应
- ✅ 删除层级钻取功能
- ✅ 优化标签清理和内存管理

### v2.3.0 (美观度增强版)
- ✅ 新增村镇名称标签显示功能
- ✅ 增强鼠标悬停凸起高度（2.5倍）
- ✅ 增强场景灯光亮度和范围
- ✅ 扩大相机可见范围（0.1-50000）
- ✅ 美化层级钻取动画效果
- ✅ 添加粒子爆炸特效
- ✅ 删除经济信息网格显示
- ✅ 优化标签入场动画

### v2.2.0 (交互体验增强版)
- ✅ 实现鼠标悬停区域凸起效果
- ✅ 添加材质高亮显示功能
- ✅ 新增悬停信息面板
- ✅ 使用InteractionManager处理3D交互
- ✅ 参考原项目省级地图交互效果
- ✅ 优化交互性能和视觉体验

### v2.1.0 (数据加载增强版)
- ✅ 新增JSON/GeoJSON文件加载功能
- ✅ 支持多种数据格式自动识别
- ✅ 添加数据源选择下拉菜单
- ✅ 实时切换不同地图数据
- ✅ 改进数据标准化处理
- ✅ 增强错误处理和用户提示

### v2.0.0 (简化版)
- ✅ 移除复杂的层级钻取功能
- ✅ 简化UI界面，只保留核心功能
- ✅ 优化数据处理，提升稳定性
- ✅ 移除统计柱状图和标签系统
- ✅ 保留基本的3D地图和视觉效果

### v1.0.0 (完整版)
- ✅ 完整的层级钻取功能
- ✅ 统计数据可视化
- ✅ 复杂的交互系统
- ✅ 丰富的功能控制面板

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支：`git checkout -b feature/新功能`
3. 提交更改：`git commit -m '添加新功能'`
4. 推送分支：`git push origin feature/新功能`
5. 提交Pull Request

## 📄 许可证

MIT License

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 项目Issues
- 邮件咨询

---

**注意**: 这是简化版本，专注于核心功能的稳定运行。如需完整功能，请参考v1.0.0版本。

## 数据源选择

系统支持多种数据源，包括沙坡头区的真实测试数据：

### 沙坡头区测试数据

#### 1. 沙坡头区（镇级）
- **数据源**: `public/assets/testTownData/shapotou.json`
- **内容**: 包含沙坡头区各个镇的详细边界数据
  - 文昌镇 (代码: 640502101)
  - 东园镇 (代码: 640502102) 
  - 兴仁镇 (代码: 640502109)
  - 宣和镇 (代码: 640502105)
- **投影参数**: 中心点 [105.19, 37.51]，缩放比例 80000
- **特色**: 真实的行政区划数据，包含人口、面积、GDP等属性

#### 2. 沙坡头区轮廓
- **数据源**: `public/assets/testTownData/沙坡头区轮廓.json`
- **内容**: 整个沙坡头区的外边界轮廓
- **投影参数**: 中心点 [105.14, 37.29]，缩放比例 25000
- **用途**: 展示沙坡头区的整体范围

### 使用方法

1. 启动开发服务器：
```bash
npm run dev
```

2. 访问村镇地图页面：
```
http://localhost:5174/#/town-map
```

3. 在导航栏的数据源选择器中选择：
   - "沙坡头区（镇级）" - 查看各个镇的详细数据
   - "沙坡头区轮廓" - 查看整体区域轮廓

### 技术特性

- **自适应投影**: 自动调整地图投影参数以最佳显示沙坡头区数据
- **交互式3D**: 支持鼠标悬停、点击交互
- **数据可视化**: 根据人口数据调整颜色深度
- **标签显示**: 自动生成镇名标签
- **动画效果**: 流畅的过渡和悬停动画

### 数据属性

每个镇包含的数据属性：
- `name`: 镇名称
- `adcode`: 行政区划代码  
- `population`: 人口数量
- `area`: 面积（平方公里）
- `center`: 地理中心点坐标
- `centroid`: 几何质心坐标
- `geometry`: GeoJSON几何数据

### 其他数据源

系统还支持：
- **内置测试数据**: 模拟的村镇数据
- **示例JSON**: 基础的测试数据
- **测试GeoJSON**: GeoJSON格式的测试数据
- **中国地图JSON**: 全国省份数据

## 配置说明

### 投影参数优化

针对沙坡头区的地理特点，系统使用了优化的投影参数：

```javascript
// 镇级数据投影
{
  center: [105.19, 37.51],  // 沙坡头区中心
  scale: 80000              // 适合镇级显示的缩放比例
}

// 区级轮廓投影  
{
  center: [105.14, 37.29],  // 区域几何中心
  scale: 25000              // 适合区级显示的缩放比例
}
```

### 地理坐标范围

沙坡头区地理坐标范围：
- 经度: 104.61° - 105.96°E
- 纬度: 36.80° - 37.71°N

这些测试数据可以帮助您：
1. 验证3D地图渲染效果
2. 测试数据加载和处理功能
3. 体验真实地理数据的可视化
4. 开发基于真实数据的地图应用 