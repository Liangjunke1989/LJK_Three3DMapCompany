# Mini3D æ¡†æž¶æŠ€æœ¯è¯¦ç»†è¯´æ˜Žæ–‡æ¡£

## ðŸ“‹ æ¦‚è¿°

Mini3Dæ˜¯ä¸€ä¸ªåŸºäºŽThree.jsçš„è½»é‡çº§3Dæ¸²æŸ“æ¡†æž¶ï¼Œä¸“é—¨ä¸º3Dåœ°å›¾å¯è§†åŒ–å’Œæ•°æ®å±•ç¤ºè€Œè®¾è®¡ã€‚è¯¥æ¡†æž¶é‡‡ç”¨æ¨¡å—åŒ–æž¶æž„ï¼Œæä¾›äº†å®Œæ•´çš„3Dæ¸²æŸ“ç®¡çº¿ã€ç»„ä»¶ç³»ç»Ÿã€äº‹ä»¶ç®¡ç†å’Œèµ„æºåŠ è½½åŠŸèƒ½ã€‚

## ðŸ—ï¸ æ•´ä½“æž¶æž„

```
Mini3D Framework
â”œâ”€â”€ Core (æ ¸å¿ƒæ¨¡å—)
â”‚   â”œâ”€â”€ Mini3d - ä¸»æ¡†æž¶ç±»
â”‚   â”œâ”€â”€ Camera - ç›¸æœºç®¡ç†
â”‚   â””â”€â”€ Renderer - æ¸²æŸ“å™¨ç®¡ç†
â”œâ”€â”€ Components (ç»„ä»¶æ¨¡å—)
â”‚   â”œâ”€â”€ Particles - ç²’å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ FlyLine - é£žçº¿æ•ˆæžœ
â”‚   â”œâ”€â”€ Label3d - 3Dæ ‡ç­¾ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Grid - ç½‘æ ¼åœ°é¢
â”‚   â”œâ”€â”€ PathLine - è·¯å¾„çº¿æ¡
â”‚   â”œâ”€â”€ Plane - å¹³é¢å‡ ä½•
â”‚   â””â”€â”€ ToastLoading - åŠ è½½æç¤º
â”œâ”€â”€ Utils (å·¥å…·æ¨¡å—)
â”‚   â”œâ”€â”€ EventEmitter - äº‹ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Resource - èµ„æºç®¡ç†
â”‚   â”œâ”€â”€ Time - æ—¶é—´ç®¡ç†
â”‚   â”œâ”€â”€ Sizes - å°ºå¯¸ç®¡ç†
â”‚   â”œâ”€â”€ CreateHistory - åŽ†å²è®°å½•
â”‚   â”œâ”€â”€ GC - åžƒåœ¾å›žæ”¶
â”‚   â””â”€â”€ utils - é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ Shader (ç€è‰²å™¨æ¨¡å—)
â”‚   â”œâ”€â”€ DiffuseShader - æ‰©æ•£ç€è‰²å™¨
â”‚   â””â”€â”€ GradientShader - æ¸å˜ç€è‰²å™¨
â””â”€â”€ Plugins (æ’ä»¶æ¨¡å—)
    â””â”€â”€ Debug - è°ƒè¯•å·¥å…·
```

## ðŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. Mini3d ä¸»æ¡†æž¶ç±»

**æ–‡ä»¶ä½ç½®**: `src/mini3d/core/index.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç»§æ‰¿è‡ªEventEmitterï¼Œæä¾›äº‹ä»¶é€šä¿¡èƒ½åŠ›
- é›†æˆTHREE.jsçš„Sceneã€Cameraã€Renderer
- æä¾›åœ°ç†æŠ•å½±åŠŸèƒ½(åŸºäºŽd3-geo)
- ç®¡ç†æ¡†æž¶ç”Ÿå‘½å‘¨æœŸ(åˆå§‹åŒ–ã€æ›´æ–°ã€é”€æ¯)

**ä¸»è¦ç‰¹æ€§**:
```javascript
class Mini3d extends EventEmitter {
  // åœ°ç†æŠ•å½±é…ç½®
  geoProjectionCenter: [0, 0]     // æŠ•å½±ä¸­å¿ƒ
  geoProjectionScale: 120         // æŠ•å½±ç¼©æ”¾
  geoProjectionTranslate: [0, 0]  // æŠ•å½±å¹³ç§»
  
  // æ ¸å¿ƒæ–¹æ³•
  setAxesHelper()     // è®¾ç½®åæ ‡è½´åŠ©æ‰‹
  geoProjection()     // åœ°ç†åæ ‡æŠ•å½±
  resize()            // å“åº”å°ºå¯¸å˜åŒ–
  update()            // æ¸²æŸ“å¾ªçŽ¯æ›´æ–°
  destroy()           // èµ„æºæ¸…ç†
}
```

### 2. Camera ç›¸æœºç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/mini3d/core/Camera.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç®¡ç†é€è§†ç›¸æœºçš„åˆ›å»ºå’Œé…ç½®
- é›†æˆOrbitControlsè½¨é“æŽ§åˆ¶å™¨
- å“åº”çª—å£å°ºå¯¸å˜åŒ–è‡ªåŠ¨è°ƒæ•´

**æŠ€æœ¯ç‰¹ç‚¹**:
- é»˜è®¤è§†è§’: FOV 45åº¦ï¼Œnear 0.1ï¼Œfar 2000
- å¯ç”¨é˜»å°¼æ•ˆæžœå¢žå¼ºäº¤äº’ä½“éªŒ
- è‡ªåŠ¨å®½é«˜æ¯”è°ƒæ•´

### 3. Renderer æ¸²æŸ“å™¨ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/mini3d/core/Renderer.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- WebGLæ¸²æŸ“å™¨çš„å°è£…å’Œé…ç½®
- æ”¯æŒåŽå¤„ç†ç®¡çº¿
- è‡ªåŠ¨é€‚é…è®¾å¤‡åƒç´ æ¯”

**æ¸²æŸ“é…ç½®**:
- å¯ç”¨é€æ˜Žåº¦æ”¯æŒ
- å¯ç”¨æŠ—é”¯é½¿
- è‡ªåŠ¨è®¾å¤‡åƒç´ æ¯”é€‚é…

## ðŸ§© ç»„ä»¶ç³»ç»Ÿè¯¦è§£

### 1. Particles ç²’å­ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/mini3d/components/Particles.js`

**æŠ€æœ¯å®žçŽ°**:
- åŸºäºŽTHREE.Pointså®žçŽ°
- æ”¯æŒè‡ªå®šä¹‰ç²’å­æ•°é‡ã€èŒƒå›´ã€é€Ÿåº¦
- ä½¿ç”¨BufferGeometryä¼˜åŒ–æ€§èƒ½
- æ”¯æŒä¸Šå‡/ä¸‹é™è¿åŠ¨æ–¹å‘

**æ ¸å¿ƒç‰¹æ€§**:
```javascript
// ç²’å­é…ç½®å‚æ•°
{
  num: 100,           // ç²’å­æ•°é‡
  range: 500,         // è¿åŠ¨èŒƒå›´
  speed: 0.01,        // è¿åŠ¨é€Ÿåº¦
  dir: "up",          // è¿åŠ¨æ–¹å‘
  material: PointsMaterial  // ç²’å­æè´¨
}
```

**æ€§èƒ½ä¼˜åŒ–**:
- ä½¿ç”¨BufferAttributeå­˜å‚¨ä½ç½®ã€é¢œè‰²ã€é€Ÿåº¦
- åœ¨GPUä¸Šè¿›è¡Œé¡¶ç‚¹è®¡ç®—
- æ”¯æŒåŠ æ³•æ··åˆå®žçŽ°å‘å…‰æ•ˆæžœ

### 2. FlyLine é£žçº¿ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/mini3d/components/FlyLine.js`

**æŠ€æœ¯å®žçŽ°**:
- åŸºäºŽQuadraticBezierCurve3äºŒæ¬¡è´å¡žå°”æ›²çº¿
- ä½¿ç”¨TubeGeometryåˆ›å»ºç®¡é“æ•ˆæžœ
- æ”¯æŒçº¹ç†åŠ¨ç”»æµåŠ¨æ•ˆæžœ

**ç®—æ³•åŽŸç†**:
1. è®¡ç®—èµ·ç‚¹å’Œç»ˆç‚¹çš„3Dåæ ‡
2. ç”Ÿæˆä¸­ç‚¹å¹¶è®¾ç½®é«˜åº¦å½¢æˆå¼§çº¿
3. åˆ›å»ºäºŒæ¬¡è´å¡žå°”æ›²çº¿è·¯å¾„
4. æ²¿è·¯å¾„ç”Ÿæˆç®¡é“å‡ ä½•ä½“
5. åº”ç”¨æµåŠ¨çº¹ç†åŠ¨ç”»

### 3. Label3d 3Dæ ‡ç­¾ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/mini3d/components/Label3d.js`

**æŠ€æœ¯å®žçŽ°**:
- åŸºäºŽCSS3DRendererå®žçŽ°HTMLå…ƒç´ 3Dæ¸²æŸ“
- æ”¯æŒCSS3DObjectå’ŒCSS3DSpriteä¸¤ç§æ¨¡å¼
- æä¾›å®Œæ•´çš„æ ‡ç­¾ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**:
- åŠ¨æ€åˆ›å»ºHTMLæ ‡ç­¾
- 3Dç©ºé—´å®šä½
- æ ·å¼è‡ªå®šä¹‰
- æ˜¾ç¤º/éšè—æŽ§åˆ¶
- è‡ªåŠ¨ç¼©æ”¾é€‚é…

### 4. Grid ç½‘æ ¼åœ°é¢

**æ–‡ä»¶ä½ç½®**: `src/mini3d/components/Grid.js`

**æŠ€æœ¯å®žçŽ°**:
- ç»“åˆGridHelperã€è‡ªå®šä¹‰å½¢çŠ¶ã€ç‚¹é˜µåˆ—
- æ”¯æŒæ‰©æ•£åŠ¨ç”»æ•ˆæžœ
- ä½¿ç”¨å‡ ä½•ä½“åˆå¹¶ä¼˜åŒ–æ€§èƒ½

**ç»„æˆå…ƒç´ **:
- GridHelper: åŸºç¡€ç½‘æ ¼çº¿
- Shapeé˜µåˆ—: è‡ªå®šä¹‰+å·å½¢çŠ¶
- Pointsé˜µåˆ—: ç‚¹çŠ¶è£…é¥°

## ðŸ› ï¸ å·¥å…·æ¨¡å—è¯¦è§£

### 1. EventEmitter äº‹ä»¶ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/mini3d/utils/EventEmitter.js`

**æŠ€æœ¯å®žçŽ°**:
- åŸºäºŽMapæ•°æ®ç»“æž„ç®¡ç†äº‹ä»¶
- æ”¯æŒonã€offã€emitã€onceæ–¹æ³•
- ä½¿ç”¨Seté¿å…é‡å¤ç›‘å¬å™¨

**è®¾è®¡æ¨¡å¼**: è§‚å¯Ÿè€…æ¨¡å¼

### 2. Resource èµ„æºç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/mini3d/utils/Resource.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç»Ÿä¸€çš„èµ„æºåŠ è½½æŽ¥å£
- æ”¯æŒå¤šç§åŠ è½½å™¨ç±»åž‹
- å¼‚æ­¥åŠ è½½å’Œè¿›åº¦ç›‘æŽ§
- èµ„æºç¼“å­˜å’Œå¤ç”¨

**æ”¯æŒçš„èµ„æºç±»åž‹**:
- GLTFæ¨¡åž‹ (æ”¯æŒDracoåŽ‹ç¼©)
- çº¹ç†è´´å›¾
- JSONæ•°æ®æ–‡ä»¶
- å­—ä½“æ–‡ä»¶
- ç«‹æ–¹ä½“è´´å›¾ç­‰

**åŠ è½½æµç¨‹**:
1. æ³¨å†Œå¯¹åº”ç±»åž‹çš„åŠ è½½å™¨
2. é…ç½®èµ„æºæ¸…å•
3. æ‰¹é‡å¼‚æ­¥åŠ è½½
4. è¿›åº¦ç›‘æŽ§å’Œé”™è¯¯å¤„ç†
5. å®Œæˆå›žè°ƒå’Œèµ„æºè®¿é—®

### 3. Time æ—¶é—´ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/mini3d/utils/Time.js`

**æŠ€æœ¯å®žçŽ°**:
- åŸºäºŽrequestAnimationFrameçš„æ¸²æŸ“å¾ªçŽ¯
- æä¾›deltaæ—¶é—´å’Œç´¯è®¡æ—¶é—´
- é›†æˆTHREE.ClockèŽ·å¾—é«˜ç²¾åº¦æ—¶é—´

**æ ¸å¿ƒæŒ‡æ ‡**:
- delta: å¸§é—´æ—¶é—´å·®
- elapsed: ç´¯è®¡è¿è¡Œæ—¶é—´
- current: å½“å‰æ—¶é—´æˆ³

### 4. Sizes å°ºå¯¸ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/mini3d/utils/Sizes.js`

**åŠŸèƒ½ç‰¹æ€§**:
- è‡ªåŠ¨ç›‘å¬çª—å£å°ºå¯¸å˜åŒ–
- æä¾›è®¾å¤‡åƒç´ æ¯”é€‚é…
- å“åº”å¼è®¾è®¡æ”¯æŒ

### 5. å·¥å…·å‡½æ•°é›†åˆ

**æ–‡ä»¶ä½ç½®**: `src/mini3d/utils/utils.js`

**æ ¸å¿ƒå‡½æ•°**:

1. **getBoundBox()** - åŒ…å›´ç›’è®¡ç®—
   - è®¡ç®—3Då¯¹è±¡çš„è¾¹ç•Œæ¡†
   - æä¾›å°ºå¯¸ã€ä¸­å¿ƒç‚¹ä¿¡æ¯
   - æ”¯æŒå‡ ä½•ä½“å’Œç»„å¯¹è±¡

2. **transfromMapGeoJSON()** - åœ°å›¾æ•°æ®è½¬æ¢
   - æ ‡å‡†åŒ–GeoJSONæ•°æ®æ ¼å¼
   - å¤„ç†Polygonåˆ°MultiPolygonè½¬æ¢
   - ç¡®ä¿åæ ‡æ•°æ®ä¸€è‡´æ€§

3. **deepClone()** - æ·±åº¦å…‹éš†
   - å®Œæ•´çš„å¯¹è±¡æ·±æ‹·è´
   - å¤„ç†å¾ªçŽ¯å¼•ç”¨
   - æ”¯æŒæ•°ç»„å’Œå¯¹è±¡

4. **uuid()** - å”¯ä¸€æ ‡è¯†ç”Ÿæˆ
   - ç”Ÿæˆéšæœºå”¯ä¸€æ ‡è¯†ç¬¦
   - æ”¯æŒè‡ªå®šä¹‰é•¿åº¦å’ŒåŸºæ•°

## ðŸŽ¨ ç€è‰²å™¨ç³»ç»Ÿè¯¦è§£

### 1. DiffuseShader æ‰©æ•£ç€è‰²å™¨

**æ–‡ä»¶ä½ç½®**: `src/mini3d/shader/DiffuseShader.js`

**æŠ€æœ¯åŽŸç†**:
- åŸºäºŽè·ç¦»çš„æ¶Ÿæ¼ªæ‰©æ•£æ•ˆæžœ
- æ”¯æŒXYå’ŒXZå¹³é¢æ‰©æ•£æ–¹å‘
- æ—¶é—´é©±åŠ¨çš„å¾ªçŽ¯åŠ¨ç”»

**GLSLæ ¸å¿ƒç®—æ³•**:
```glsl
// è®¡ç®—åˆ°ä¸­å¿ƒçš„è·ç¦»
float rDistance = distance(vPosition.xz, center);

// åˆ¤æ–­æ˜¯å¦åœ¨æ‰©æ•£åœ†çŽ¯å†…
if(rDistance > r && rDistance < r + 2.0 * w) {
  // è®¡ç®—æ¸å˜ç³»æ•°
  float per = (rDistance - r) / w;
  // åº”ç”¨é¢œè‰²æ··åˆ
  outgoingLight = mix(outgoingLight, uColor, per);
}
```

### 2. GradientShader æ¸å˜ç€è‰²å™¨

**æ–‡ä»¶ä½ç½®**: `src/mini3d/shader/GradientShader.js`

**æŠ€æœ¯å®žçŽ°**:
- æ”¯æŒXã€Yã€Zä¸‰ä¸ªæ–¹å‘çš„æ¸å˜
- è‡ªå®šä¹‰æ¸å˜è‰²å½©å’ŒèŒƒå›´
- åŠ¨æ€ä¿®æ”¹æè´¨ç€è‰²

**åº”ç”¨åœºæ™¯**:
- åœ°å½¢é«˜åº¦æ¸å˜
- å»ºç­‘ç‰©ç«‹é¢æ•ˆæžœ
- æ•°æ®å¯è§†åŒ–è‰²å½©æ˜ å°„

## ðŸ”§ é«˜çº§ç‰¹æ€§

### 1. åœ°ç†æŠ•å½±ç³»ç»Ÿ

**åŸºäºŽd3-geo**:
- å¢¨å¡æ‰˜æŠ•å½± (geoMercator)
- è‡ªå®šä¹‰æŠ•å½±ä¸­å¿ƒå’Œç¼©æ”¾
- ç»çº¬åº¦åˆ°å±å¹•åæ ‡è½¬æ¢

### 2. å†…å­˜ç®¡ç†

**GCåžƒåœ¾å›žæ”¶** (`src/mini3d/utils/GC.js`):
- è‡ªåŠ¨é‡Šæ”¾å‡ ä½•ä½“èµ„æº
- æè´¨å’Œçº¹ç†æ¸…ç†
- é€’å½’å¯¹è±¡é”€æ¯

### 3. åŽ†å²è®°å½•ç³»ç»Ÿ

**CreateHistory** (`src/mini3d/utils/CreateHistory.js`):
- æ’¤é”€/é‡åšåŠŸèƒ½
- çŠ¶æ€å¿«ç…§ç®¡ç†
- æ—¶é—´è½´å¯¼èˆª

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å‡ ä½•ä½“ä¼˜åŒ–
- ä½¿ç”¨BufferGeometryæ›¿ä»£Geometry
- å‡ ä½•ä½“åˆå¹¶å‡å°‘ç»˜åˆ¶è°ƒç”¨
- LOD (Level of Detail) æ”¯æŒ

### 2. æè´¨ä¼˜åŒ–
- æè´¨å¤ç”¨å’Œå…±äº«
- çº¹ç†åŽ‹ç¼©å’Œmipmaps
- ç€è‰²å™¨ç¼“å­˜

### 3. æ¸²æŸ“ä¼˜åŒ–
- è§†é”¥å‰”é™¤
- æ¸²æŸ“é¡ºåºä¼˜åŒ–
- æ‰¹é‡æ¸²æŸ“

### 4. å†…å­˜ä¼˜åŒ–
- èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†
- åŠæ—¶é‡Šæ”¾æœªä½¿ç”¨èµ„æº
- å¯¹è±¡æ± å¤ç”¨

## ðŸš€ æ‰©å±•æ€§è®¾è®¡

### 1. ç»„ä»¶ç³»ç»Ÿ
- æ ‡å‡†åŒ–ç»„ä»¶æŽ¥å£
- ç”Ÿå‘½å‘¨æœŸé’©å­
- ä¾èµ–æ³¨å…¥æ”¯æŒ

### 2. æ’ä»¶æž¶æž„
- å¯æ’æ‹”çš„åŠŸèƒ½æ¨¡å—
- ç»Ÿä¸€çš„æ’ä»¶æŽ¥å£
- è¿è¡Œæ—¶åŠ¨æ€åŠ è½½

### 3. äº‹ä»¶é©±åŠ¨
- è§£è€¦çš„é€šä¿¡æœºåˆ¶
- å¼‚æ­¥äº‹ä»¶å¤„ç†
- è‡ªå®šä¹‰äº‹ä»¶æ”¯æŒ

## ðŸŽ¯ ä½¿ç”¨åœºæ™¯

### 1. 3Dåœ°å›¾å¯è§†åŒ–
- åœ°ç†æ•°æ®å±•ç¤º
- åŒºåŸŸç»Ÿè®¡å¯è§†åŒ–
- è·¯å¾„è§„åˆ’æ˜¾ç¤º

### 2. æ•°æ®å¯è§†åŒ–
- ç§‘å­¦æ•°æ®å±•ç¤º
- å•†ä¸šæ™ºèƒ½å›¾è¡¨
- å®žæ—¶æ•°æ®ç›‘æŽ§

### 3. äº¤äº’å¼å±•ç¤º
- äº§å“æ¼”ç¤º
- è™šæ‹Ÿå±•åŽ…
- æ•™è‚²åŸ¹è®­

## ðŸ“ˆ æŠ€æœ¯ä¼˜åŠ¿

1. **è½»é‡çº§**: æ ¸å¿ƒä»£ç ç²¾ç®€ï¼ŒæŒ‰éœ€åŠ è½½
2. **æ¨¡å—åŒ–**: æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ˜“äºŽç»´æŠ¤
3. **é«˜æ€§èƒ½**: WebGLç¡¬ä»¶åŠ é€Ÿï¼Œä¼˜åŒ–çš„æ¸²æŸ“ç®¡çº¿
4. **æ˜“æ‰©å±•**: æ’ä»¶åŒ–æž¶æž„ï¼Œçµæ´»çš„ç»„ä»¶ç³»ç»Ÿ
5. **è·¨å¹³å°**: æ”¯æŒçŽ°ä»£æµè§ˆå™¨ï¼Œç§»åŠ¨ç«¯é€‚é…

## ðŸ” æ€»ç»“

Mini3Dæ¡†æž¶æ˜¯ä¸€ä¸ªä¸“ä¸šçš„3Då¯è§†åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ƒåœ¨Three.jsçš„åŸºç¡€ä¸Šæž„å»ºäº†å®Œæ•´çš„å¼€å‘ç”Ÿæ€ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ã€ç»„ä»¶åŒ–å¼€å‘å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œä¸º3Dåº”ç”¨å¼€å‘æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„åŸºç¡€å¹³å°ã€‚æ¡†æž¶ç‰¹åˆ«é€‚ç”¨äºŽåœ°å›¾å¯è§†åŒ–ã€æ•°æ®å±•ç¤ºå’Œäº¤äº’å¼3Dåº”ç”¨çš„å¼€å‘ã€‚ 